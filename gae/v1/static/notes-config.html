<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css"/>
		<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
		<title>PebbleNotes Configuration</title>
	</head>
	<body>
		<div data-role="page" id="page1">
			<div data-theme="" data-role="header">
				<h1>PebbleNotes</h1>
			</div>
			<div data-role="content">
				<h2>Account</h2>
				<div data-role="fieldcontain">
					<label for="option1">Option One</label>
					<select name="option1" id="option1" data-theme="" data-role="slider">
						<option value="off">Off</option>
						<option value="on">On</option>
					</select>
				</div>

				<button data-theme="b" id="btn-login">Log in</button>

				<div class="ui-body ui-body-b">
					<fieldset class="ui-grid-a">
						<div class="ui-block-a"><button type="submit" data-theme="d" id="btn-cancel">Cancel</button></div>
						<div class="ui-block-b"><button type="submit" data-theme="a" id="btn-submit">Ok</button></div>
					</fieldset>
				</div>
				<a href="pebblejs://close#">Okay</a>
			</div>
		</div>
		<script>
			<!-- from http://snipplr.com/view/26662/get-url-parameters-with-jquery--improved/ -->
			$.urlParam = function(name){
				var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href);
				if (!results) { return 0; }
				return results[1] || 0;
			}

			function updateControls() {
				var option1 = decodeURIComponent($.urlParam("option1"));
				if (option1 != '') {
					$("#option1").val(option1).slider("refresh");
				}
			}

			function saveOptions() {
				var options = {
					'option1': $("#option1").val(),
				}
				return options;
			}

			/** Log into Google account
			 */
			function doLogin() {
				window.location = "auth?" + $.param({
						response_type: "code",
						scope: "https://www.googleapis.com/auth/tasks",
						state: "",
						access_type: "offline",
						approval_prompt: "force", // If user tries to authenticate then we have no valid refresh tokens.
						include_granted_scopes: "false",
				});
			}

			$().ready(function() {
				$("#btn-cancel").click(function() {
					console.log("Cancel");
					window.location = "pebblejs://close#";
				});

				$("#btn-submit").click(function() {
					console.log("Submit");

					var location = "pebblejs://close#" + encodeURIComponent(JSON.stringify(saveOptions()));
					console.log(location);
					window.location = location;
				});

				$("#btn-login").click(function() {
					console.log("Login");
					doLogin();
				});
			});

			$('#page1').bind('pageinit', updateControls);
		</script>
	</body>
</html>
